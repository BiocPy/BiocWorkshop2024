<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Tutorial 1: Perform range-based analyses using GenomicRanges – Bioc2024: Interoperability between R and Python using BiocPy</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href=".././assets/short.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Tutorial 1: Perform range-based analyses using <code>GenomicRanges</code></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src=".././assets/logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main">
    <a href="https://github.com/BiocPy/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interoperability between R and Python using BiocPy</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../howto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to run the notebooks</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/genomic_ranges.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tutorial 1: Perform range-based analyses using <code>GenomicRanges</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/annotate_cell_types.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tutorial 2: Annotate cell types in single-cell RNA-seq data</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tutorials/sessioninfo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session Info</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#outline" id="toc-outline" class="nav-link active" data-scroll-target="#outline">Outline</a></li>
  <li><a href="#prerequisites" id="toc-prerequisites" class="nav-link" data-scroll-target="#prerequisites">Prerequisites</a></li>
  <li><a href="#download-reference-annotation" id="toc-download-reference-annotation" class="nav-link" data-scroll-target="#download-reference-annotation">1. Download reference annotation</a></li>
  <li><a href="#load-genome-annotation-in-python" id="toc-load-genome-annotation-in-python" class="nav-link" data-scroll-target="#load-genome-annotation-in-python">2. Load genome annotation in Python</a></li>
  <li><a href="#define-promoters-and-tss" id="toc-define-promoters-and-tss" class="nav-link" data-scroll-target="#define-promoters-and-tss">3. Define promoters and TSS</a>
  <ul class="collapse">
  <li><a href="#find-transcription-start-sites-tss" id="toc-find-transcription-start-sites-tss" class="nav-link" data-scroll-target="#find-transcription-start-sites-tss">3.1 Find transcription start sites (TSS)</a></li>
  <li><a href="#define-promoter-regions" id="toc-define-promoter-regions" class="nav-link" data-scroll-target="#define-promoter-regions">3.2 Define promoter regions</a></li>
  </ul></li>
  <li><a href="#overlap-with-chip-seq-peaks" id="toc-overlap-with-chip-seq-peaks" class="nav-link" data-scroll-target="#overlap-with-chip-seq-peaks">4. Overlap with ChIP-seq peaks</a>
  <ul class="collapse">
  <li><a href="#load-chip-seq-peaks" id="toc-load-chip-seq-peaks" class="nav-link" data-scroll-target="#load-chip-seq-peaks">4.1 Load ChIP-seq peaks</a></li>
  <li><a href="#find-overlaps-with-tss" id="toc-find-overlaps-with-tss" class="nav-link" data-scroll-target="#find-overlaps-with-tss">4.2 Find overlaps with TSS</a></li>
  <li><a href="#find-overlaps-with-promoters" id="toc-find-overlaps-with-promoters" class="nav-link" data-scroll-target="#find-overlaps-with-promoters">4.3 Find overlaps with promoters</a></li>
  <li><a href="#find-overlaps-with-exons" id="toc-find-overlaps-with-exons" class="nav-link" data-scroll-target="#find-overlaps-with-exons">4.4 Find overlaps with exons</a></li>
  </ul></li>
  <li><a href="#advanced-operations" id="toc-advanced-operations" class="nav-link" data-scroll-target="#advanced-operations">5. Advanced Operations</a>
  <ul class="collapse">
  <li><a href="#compare-exonic-vs.-intronic-binding" id="toc-compare-exonic-vs.-intronic-binding" class="nav-link" data-scroll-target="#compare-exonic-vs.-intronic-binding">5.1 Compare exonic vs.&nbsp;intronic binding</a></li>
  <li><a href="#find-overlaps-with-the-first-exon" id="toc-find-overlaps-with-the-first-exon" class="nav-link" data-scroll-target="#find-overlaps-with-the-first-exon">5.2 Find overlaps with the first exon</a></li>
  <li><a href="#resize-and-shift-peaks" id="toc-resize-and-shift-peaks" class="nav-link" data-scroll-target="#resize-and-shift-peaks">5.3 Resize and Shift Peaks</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">6. Exercises</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/BiocPy/BiocWorkshop2024/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Tutorial 1: Perform range-based analyses using <code>GenomicRanges</code></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Genomic range operations are fundamental to many bioinformatics analyses. They allow us to work with intervals of genomic coordinates, which is crucial for understanding the relationships between different genomic features such as genes, regulatory elements, and experimental data like ChIP-seq peaks. In this tutorial, we’ll explore how to work with genomic interval data using BiocPy’s <a href="https://github.com/BiocPy/GenomicRanges/">GenomicRanges</a> package, which provides a Python implementation of the R/Bioconductor <a href="https://github.com/Bioconductor/GenomicRanges">GenomicRanges package</a>.</p>
<section id="outline" class="level2">
<h2 class="anchored" data-anchor-id="outline">Outline</h2>
<p>In this workshop, we’ll walk through several aspects of working with genomic ranges in Python:</p>
<ol type="1">
<li><strong>Reading genomic data</strong>: we’ll start by reading in genomic data from RDS files, including exon positions grouped by transcripts.</li>
<li><strong>Basic genomic operations</strong>: we’ll cover fundamental operations like finding transcription start sites (TSS) and promoter regions.</li>
<li><strong>Overlap analysis</strong>: we’ll learn how to find overlaps between different genomic features, a common task in many analyses.</li>
<li><strong>Advanced operations</strong>: we’ll explore more complex operations like finding peaks within specific regions and resizing genomic intervals.</li>
</ol>
</section>
<section id="prerequisites" class="level2">
<h2 class="anchored" data-anchor-id="prerequisites">Prerequisites</h2>
<p>Before we begin, please ensure that you have the following prerequisites installed:</p>
<ul>
<li>Python 3.8 or later with dependencies listed <a href="https://github.com/BiocPy/BiocWorkshop2024/blob/master/requirements.txt">here</a>.</li>
<li>R 4.4.0 and Bioconductor packages listed <a href="https://github.com/BiocPy/BiocWorkshop2024/blob/master/rpackages.R">here</a>.</li>
</ul>
<p>Install the Python packages using pip:</p>
<p>!pip install -U biocutils genomicranges rds2py numpy pandas geniml</p>
<p>Install the R packages using <code>BiocManager</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>BiocManager<span class="sc">::</span><span class="fu">install</span>(<span class="fu">c</span>(<span class="st">"AnnotationHub"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="download-reference-annotation" class="level2">
<h2 class="anchored" data-anchor-id="download-reference-annotation">1. Download reference annotation</h2>
<p>Insead of reinventing the wheel to access references in Python, we’ll use existing available Bioconductor resources that provide access to genome annotations. <code>AnnotationHub</code> is a great resource providing access to genomic reference annotations. It’s super convenient to search for a reference from <code>AnnotationHub</code> and download the genome of interest.</p>
<p>Let’s search the latest ensembl database for the human reference genome using Bioconductor’s <code>AnnotationHub</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(AnnotationHub))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>ah <span class="ot">&lt;-</span> <span class="fu">AnnotationHub</span>()</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>ensdb <span class="ot">&lt;-</span> <span class="fu">query</span>(ah, <span class="st">"Ensembl 112 EnsDb for Homo sapiens"</span>)[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We will then extract the exon positions and group them by transcript. Additionally, we provide a list of column names we would like to be available in <code>mcols</code> for our analysis. For the purpose of this tutorial, we’ll limit ourselves to the exons from chromosome 22.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>exons_by_tx <span class="ot">&lt;-</span> <span class="fu">exonsBy</span>(ensdb, </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"tx"</span>, <span class="at">filter =</span> <span class="fu">SeqNameFilter</span>(<span class="fu">c</span>(<span class="st">"22"</span>)), </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">columns=</span> <span class="fu">c</span>(<span class="st">"exon_id"</span>, <span class="st">"tx_name"</span>, <span class="st">"tx_id"</span>, <span class="st">"gene_name"</span>, <span class="st">"gene_id"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Finally, save the object as an RDS file.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(exons_by_tx, <span class="st">"hg38_exons_by_tx.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you are using Google Colab, you may not have access to the RDS file used, in this tutorial. Change the block below from markdown to code and run the chunk.</p>
<p>!wget https://raw.githubusercontent.com/BiocPy/BiocWorkshop2024/master/notebook/hg38_exons_by_tx.rds</p>
</section>
<section id="load-genome-annotation-in-python" class="level2">
<h2 class="anchored" data-anchor-id="load-genome-annotation-in-python">2. Load genome annotation in Python</h2>
<p>We now read the above RDS annotation object into our Python session using the <a href="https://github.com/biocpy/rds2py">rds2py</a> Python package. This is a two step process.</p>
<p>The first step represents the data stored in the RDS file as a python dictionary</p>
<div id="cell-7" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rds2py <span class="im">import</span> read_rds</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>hg38_robject <span class="op">=</span> read_rds(<span class="st">"./hg38_exons_by_tx.rds"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Only printing the keys</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Keys of the object:"</span>, hg38_robject.keys())</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Class name of the object:"</span>, hg38_robject[<span class="st">"class_name"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Keys of the object: dict_keys(['data', 'package_name', 'class_name', 'attributes'])
Class name of the object: CompressedGRangesList</code></pre>
</div>
</div>
<p>This dictionary object (<code>hg38_robject</code>) contains 4 keys:</p>
<ol type="1">
<li><strong>class_name</strong>: class name of the object</li>
<li><strong>package_name</strong>: name of the package containing the class definition</li>
<li><strong>data</strong>: contains the value if the object is a scalar</li>
<li><strong>attributes</strong>: if the object is an S4 class, contains various attributes and their values</li>
</ol>
<p>This dictionary can then be coerced into a Python <code>GenomicRangesList</code> class.</p>
<div id="cell-9" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rds2py.granges <span class="im">import</span> as_granges_list</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>by_tx <span class="op">=</span> as_granges_list(hg38_robject)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Exons by transcript:"</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(by_tx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Exons by transcript:
GenomicRangesList with 5387 ranges and 0 metadata columns
 
Name: ENST00000006251 
GenomicRanges with 9 ranges and 6 metadata columns
    seqnames              ranges          strand           exon_id         tx_name           tx_id gene_name         gene_id exon_rank
       &lt;str&gt;           &lt;IRanges&gt; &lt;ndarray[int8]&gt;            &lt;list&gt;          &lt;list&gt;          &lt;list&gt;    &lt;list&gt;          &lt;list&gt;    &lt;list&gt;
[0]    chr22 44677057 - 44677241               + | ENSE00001838743 ENST00000006251 ENST00000006251      PRR5 ENSG00000186654         1
[1]    chr22 44702492 - 44702609               + | ENSE00003647870 ENST00000006251 ENST00000006251      PRR5 ENSG00000186654         2
[2]    chr22 44714591 - 44714672               + | ENSE00003614159 ENST00000006251 ENST00000006251      PRR5 ENSG00000186654         3
[3]    chr22 44725244 - 44725293               + | ENSE00003568825 ENST00000006251 ENST00000006251      PRR5 ENSG00000186654         4
[4]    chr22 44726577 - 44726635               + | ENSE00003465556 ENST00000006251 ENST00000006251      PRR5 ENSG00000186654         5
[5]    chr22 44731730 - 44731822               + | ENSE00003642381 ENST00000006251 ENST00000006251      PRR5 ENSG00000186654         6
[6]    chr22 44732251 - 44732392               + | ENSE00003658491 ENST00000006251 ENST00000006251      PRR5 ENSG00000186654         7
[7]    chr22 44735027 - 44735163               + | ENSE00003692865 ENST00000006251 ENST00000006251      PRR5 ENSG00000186654         8
[8]    chr22 44736772 - 44737681               + | ENSE00001846334 ENST00000006251 ENST00000006251      PRR5 ENSG00000186654         9
------
seqinfo(1 sequences): chr22
 
Name: ENST00000008876 
GenomicRanges with 10 ranges and 6 metadata columns
    seqnames              ranges          strand           exon_id         tx_name           tx_id gene_name         gene_id exon_rank
       &lt;str&gt;           &lt;IRanges&gt; &lt;ndarray[int8]&gt;            &lt;list&gt;          &lt;list&gt;          &lt;list&gt;    &lt;list&gt;          &lt;list&gt;    &lt;list&gt;
[0]    chr22 50603133 - 50603499               + | ENSE00003608148 ENST00000008876 ENST00000008876  MAPK8IP2 ENSG00000008735         1
[1]    chr22 50603626 - 50603720               + | ENSE00003768317 ENST00000008876 ENST00000008876  MAPK8IP2 ENSG00000008735         2
[2]    chr22 50603841 - 50605065               + | ENSE00003772801 ENST00000008876 ENST00000008876  MAPK8IP2 ENSG00000008735         3
[3]    chr22 50605368 - 50605444               + | ENSE00003773674 ENST00000008876 ENST00000008876  MAPK8IP2 ENSG00000008735         4
[4]    chr22 50605562 - 50605735               + | ENSE00003765641 ENST00000008876 ENST00000008876  MAPK8IP2 ENSG00000008735         5
[5]    chr22 50605825 - 50605935               + | ENSE00003763622 ENST00000008876 ENST00000008876  MAPK8IP2 ENSG00000008735         6
[6]    chr22 50606658 - 50606766               + | ENSE00003773228 ENST00000008876 ENST00000008876  MAPK8IP2 ENSG00000008735         7
[7]    chr22 50606921 - 50606992               + | ENSE00003769486 ENST00000008876 ENST00000008876  MAPK8IP2 ENSG00000008735         8
[8]    chr22 50610212 - 50610311               + | ENSE00003772161 ENST00000008876 ENST00000008876  MAPK8IP2 ENSG00000008735         9
[9]    chr22 50610707 - 50613982               + | ENSE00003731955 ENST00000008876 ENST00000008876  MAPK8IP2 ENSG00000008735        10
------
seqinfo(1 sequences): chr22
 
Name: ENST00000043402 
GenomicRanges with 2 ranges and 6 metadata columns
    seqnames              ranges          strand           exon_id         tx_name           tx_id gene_name         gene_id exon_rank
       &lt;str&gt;           &lt;IRanges&gt; &lt;ndarray[int8]&gt;            &lt;list&gt;          &lt;list&gt;          &lt;list&gt;    &lt;list&gt;          &lt;list&gt;    &lt;list&gt;
[0]    chr22 20268071 - 20268319               - | ENSE00001358408 ENST00000043402 ENST00000043402     RTN4R ENSG00000040608         1
[1]    chr22 20241415 - 20243111               - | ENSE00001557601 ENST00000043402 ENST00000043402     RTN4R ENSG00000040608         2
------
seqinfo(1 sequences): chr22
 
Name:  
GenomicRanges with 15 ranges and 6 metadata columns
     seqnames              ranges          strand        exon_id   tx_name     tx_id gene_name gene_id exon_rank
        &lt;str&gt;           &lt;IRanges&gt; &lt;ndarray[int8]&gt;         &lt;list&gt;    &lt;list&gt;    &lt;list&gt;    &lt;list&gt;  &lt;list&gt;    &lt;list&gt;
 [0]    chr22 33919995 - 33920477               - |  LRG_856t1e1 LRG_856t2 LRG_856t2    LARGE1 LRG_856         1
 [1]    chr22 33761371 - 33761559               - |  LRG_856t1e3 LRG_856t2 LRG_856t2    LARGE1 LRG_856         2
 [2]    chr22 33650367 - 33650669               - |  LRG_856t1e4 LRG_856t2 LRG_856t2    LARGE1 LRG_856         3
          ...                 ...             ... |          ...       ...       ...       ...     ...       ...
[12]    chr22 33283202 - 33283349               - | LRG_856t1e14 LRG_856t2 LRG_856t2    LARGE1 LRG_856        13
[13]    chr22 33277060 - 33277256               - | LRG_856t1e15 LRG_856t2 LRG_856t2    LARGE1 LRG_856        14
[14]    chr22 33272509 - 33274625               - | LRG_856t1e16 LRG_856t2 LRG_856t2    LARGE1 LRG_856        15
------
seqinfo(1 sequences): chr22
 
Name: LRG_856t2 
GenomicRanges with 7 ranges and 6 metadata columns
    seqnames              ranges          strand      exon_id  tx_name    tx_id gene_name gene_id exon_rank
       &lt;str&gt;           &lt;IRanges&gt; &lt;ndarray[int8]&gt;       &lt;list&gt;   &lt;list&gt;   &lt;list&gt;    &lt;list&gt;  &lt;list&gt;    &lt;list&gt;
[0]    chr22 37244114 - 37244266               - | LRG_97t1e1 LRG_97t1 LRG_97t1      RAC2  LRG_97         1
[1]    chr22 37241587 - 37241659               - | LRG_97t1e2 LRG_97t1 LRG_97t1      RAC2  LRG_97         2
[2]    chr22 37232801 - 37232919               - | LRG_97t1e3 LRG_97t1 LRG_97t1      RAC2  LRG_97         3
[3]    chr22 37231932 - 37231995               - | LRG_97t1e4 LRG_97t1 LRG_97t1      RAC2  LRG_97         4
[4]    chr22 37231231 - 37231391               - | LRG_97t1e5 LRG_97t1 LRG_97t1      RAC2  LRG_97         5
[5]    chr22 37226671 - 37226804               - | LRG_97t1e6 LRG_97t1 LRG_97t1      RAC2  LRG_97         6
[6]    chr22 37225270 - 37226040               - | LRG_97t1e7 LRG_97t1 LRG_97t1      RAC2  LRG_97         7
------
seqinfo(1 sequences): chr22
 
Name: LRG_97t1 
GenomicRanges with 21 ranges and 6 metadata columns
     seqnames              ranges          strand        exon_id   tx_name     tx_id gene_name gene_id exon_rank
        &lt;str&gt;           &lt;IRanges&gt; &lt;ndarray[int8]&gt;         &lt;list&gt;    &lt;list&gt;    &lt;list&gt;    &lt;list&gt;  &lt;list&gt;    &lt;list&gt;
 [0]    chr22 20982297 - 20982572               + |  LRG_989t1e1 LRG_989t1 LRG_989t1     LZTR1 LRG_989         1
 [1]    chr22 20983027 - 20983090               + |  LRG_989t1e2 LRG_989t1 LRG_989t1     LZTR1 LRG_989         2
 [2]    chr22 20985841 - 20985898               + |  LRG_989t1e3 LRG_989t1 LRG_989t1     LZTR1 LRG_989         3
          ...                 ...             ... |          ...       ...       ...       ...     ...       ...
[18]    chr22 20996696 - 20996802               + | LRG_989t1e19 LRG_989t1 LRG_989t1     LZTR1 LRG_989        19
[19]    chr22 20996886 - 20996967               + | LRG_989t1e20 LRG_989t1 LRG_989t1     LZTR1 LRG_989        20
[20]    chr22 20997232 - 20999033               + | LRG_989t1e21 LRG_989t1 LRG_989t1     LZTR1 LRG_989        21
------
seqinfo(1 sequences): chr22
 
</code></pre>
</div>
</div>
<pre class="{note}"><code>Currently this is a two step process, we are working on simplifying this to a single step for supported Bioconductor classes.</code></pre>
</section>
<section id="define-promoters-and-tss" class="level2">
<h2 class="anchored" data-anchor-id="define-promoters-and-tss">3. Define promoters and TSS</h2>
<p>Now, let’s perform some basic operations like finding transcription start sites (TSS) and promoter regions. These operations help us identify key regulatory regions of the genome.</p>
<section id="find-transcription-start-sites-tss" class="level3">
<h3 class="anchored" data-anchor-id="find-transcription-start-sites-tss">3.1 Find transcription start sites (TSS)</h3>
<p>Transcription Start Sites (TSS) are the locations where transcription of a gene begins. Identifying TSS is crucial for understanding gene regulation, as many regulatory elements are located near the TSS.</p>
<p>First, we use the <code>range()</code> method to get the full extent of each transcript. This should give us exactly one range per transcript.</p>
<div id="cell-11" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ranges_by_tx <span class="op">=</span> by_tx.<span class="bu">range</span>()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Transcript ranges:"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ranges_by_tx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Transcript ranges:
GenomicRangesList with 5387 ranges and 0 metadata columns
 
Name: ENST00000006251 
GenomicRanges with 1 range and 0 metadata columns
    seqnames              ranges          strand
       &lt;str&gt;           &lt;IRanges&gt; &lt;ndarray[int8]&gt;
[0]    chr22 44677057 - 44737681               +
------
seqinfo(1 sequences): chr22
 
Name: ENST00000008876 
GenomicRanges with 1 range and 0 metadata columns
    seqnames              ranges          strand
       &lt;str&gt;           &lt;IRanges&gt; &lt;ndarray[int8]&gt;
[0]    chr22 50603133 - 50613982               +
------
seqinfo(1 sequences): chr22
 
Name: ENST00000043402 
GenomicRanges with 1 range and 0 metadata columns
    seqnames              ranges          strand
       &lt;str&gt;           &lt;IRanges&gt; &lt;ndarray[int8]&gt;
[0]    chr22 20241415 - 20268319               -
------
seqinfo(1 sequences): chr22
 
Name:  
GenomicRanges with 1 range and 0 metadata columns
    seqnames              ranges          strand
       &lt;str&gt;           &lt;IRanges&gt; &lt;ndarray[int8]&gt;
[0]    chr22 33272509 - 33920477               -
------
seqinfo(1 sequences): chr22
 
Name: LRG_856t2 
GenomicRanges with 1 range and 0 metadata columns
    seqnames              ranges          strand
       &lt;str&gt;           &lt;IRanges&gt; &lt;ndarray[int8]&gt;
[0]    chr22 37225270 - 37244266               -
------
seqinfo(1 sequences): chr22
 
Name: LRG_97t1 
GenomicRanges with 1 range and 0 metadata columns
    seqnames              ranges          strand
       &lt;str&gt;           &lt;IRanges&gt; &lt;ndarray[int8]&gt;
[0]    chr22 20982297 - 20999033               +
------
seqinfo(1 sequences): chr22
 
</code></pre>
</div>
</div>
<p>Since the <code>range()</code> gives us exactly one range per transcript, so we can simplify our list to a <code>GenomicRanges</code> object. This is similar to <code>unlist</code> in R.</p>
<div id="cell-13" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>gr_by_tx <span class="op">=</span> ranges_by_tx.as_genomic_ranges()</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"as GenomicRanges:"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(gr_by_tx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>as GenomicRanges:
GenomicRanges with 5387 ranges and 0 metadata columns
                seqnames              ranges          strand
                   &lt;str&gt;           &lt;IRanges&gt; &lt;ndarray[int8]&gt;
ENST00000006251    chr22 44677057 - 44737681               +
ENST00000008876    chr22 50603133 - 50613982               +
ENST00000043402    chr22 20241415 - 20268319               -
                     ...                 ...             ...
      LRG_856t2    chr22 33272509 - 33920477               -
       LRG_97t1    chr22 37225270 - 37244266               -
      LRG_989t1    chr22 20982297 - 20999033               +
------
seqinfo(1 sequences): chr22</code></pre>
</div>
</div>
<p>Then we resize to a width of 1 base pair at the start of each range to pinpoint the TSS.</p>
<div id="cell-15" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>tss <span class="op">=</span> gr_by_tx.resize(width<span class="op">=</span><span class="dv">1</span>, fix<span class="op">=</span><span class="st">"start"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Transcript Start Sites:"</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tss)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Transcript Start Sites:
GenomicRanges with 5387 ranges and 0 metadata columns
                seqnames              ranges          strand
                   &lt;str&gt;           &lt;IRanges&gt; &lt;ndarray[int8]&gt;
ENST00000006251    chr22 44677057 - 44677058               +
ENST00000008876    chr22 50603133 - 50603134               +
ENST00000043402    chr22 20268318 - 20268319               -
                     ...                 ...             ...
      LRG_856t2    chr22 33920476 - 33920477               -
       LRG_97t1    chr22 37244265 - 37244266               -
      LRG_989t1    chr22 20982297 - 20982298               +
------
seqinfo(1 sequences): chr22</code></pre>
</div>
</div>
</section>
<section id="define-promoter-regions" class="level3">
<h3 class="anchored" data-anchor-id="define-promoter-regions">3.2 Define promoter regions</h3>
<p>Here, we’re defining promoters as the region 2000 base pairs upstream to 200 base pairs downstream of each TSS. This definition can vary depending on the specific analysis, but this range often captures important regulatory elements.</p>
<div id="cell-17" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>promoters <span class="op">=</span> tss.promoters(upstream<span class="op">=</span><span class="dv">2000</span>, downstream<span class="op">=</span><span class="dv">200</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Promoter Regions:"</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(promoters)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Promoter Regions:
GenomicRanges with 5387 ranges and 0 metadata columns
                seqnames              ranges          strand
                   &lt;str&gt;           &lt;IRanges&gt; &lt;ndarray[int8]&gt;
ENST00000006251    chr22 44675057 - 44677257               +
ENST00000008876    chr22 50601133 - 50603333               +
ENST00000043402    chr22 20268119 - 20270319               -
                     ...                 ...             ...
      LRG_856t2    chr22 33920277 - 33922477               -
       LRG_97t1    chr22 37244066 - 37246266               -
      LRG_989t1    chr22 20980297 - 20982497               +
------
seqinfo(1 sequences): chr22</code></pre>
</div>
</div>
</section>
</section>
<section id="overlap-with-chip-seq-peaks" class="level2">
<h2 class="anchored" data-anchor-id="overlap-with-chip-seq-peaks">4. Overlap with ChIP-seq peaks</h2>
<p>A common task in genomic analysis is finding overlaps between different genomic features. This helps us understand the relationships between various elements in the genome and can provide insights into gene regulation and function.</p>
<section id="load-chip-seq-peaks" class="level3">
<h3 class="anchored" data-anchor-id="load-chip-seq-peaks">4.1 Load ChIP-seq peaks</h3>
<p>ChIP-seq (Chromatin Immunoprecipitation followed by sequencing) is a method used to identify binding sites of DNA-associated proteins. The peaks represent regions where a protein of interest is likely bound to the DNA.</p>
<p>For the purpose of this tutorial, let’s download a bed file containing peaks from a ChIP-seq experiment on human B cells to identify EZH2 binding sites (from ENCODE) and catalogued in <a href="https://bedbase.org/bed/be4054acf6e3feeb4dc490e6430e358e">bedbase.org</a>.</p>
<div id="cell-19" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> geniml.bbclient <span class="im">import</span> BBClient</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>bbclient <span class="op">=</span> BBClient(cache_folder<span class="op">=</span><span class="st">"cache"</span>, bedbase_api<span class="op">=</span><span class="st">"https://api.bedbase.org"</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>bedfile_id <span class="op">=</span> <span class="st">"be4054acf6e3feeb4dc490e6430e358e"</span> </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>bedfile <span class="op">=</span> bbclient.load_bed(bedfile_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our friends at bedbase (Nathan Sheffield et al.) provide methods to easily coerce these objects to <code>GenomicRanges</code>. Again, we’re focusing on chromosome 22 for this example to keep the dataset manageable.</p>
<div id="cell-21" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>peaks <span class="op">=</span> bedfile.to_granges()</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>filter_chr22 <span class="op">=</span> [x <span class="op">==</span> <span class="st">"chr22"</span> <span class="cf">for</span> x <span class="kw">in</span> peaks.get_seqnames()]</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>peaks_chr22 <span class="op">=</span> peaks[filter_chr22]</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(peaks_chr22)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>GenomicRanges with 1441 ranges and 0 metadata columns
       seqnames              ranges          strand
          &lt;str&gt;           &lt;IRanges&gt; &lt;ndarray[int8]&gt;
   [0]    chr22 19766788 - 19767078               *
   [1]    chr22 17369888 - 17370178               *
   [2]    chr22 19756445 - 19756735               *
            ...                 ...             ...
[1438]    chr22 27212058 - 27212348               *
[1439]    chr22 49201359 - 49201649               *
[1440]    chr22 49663362 - 49663652               *
------
seqinfo(46 sequences): chr1 chr10 chr11 ... chrUn_KI270750v1 chrUn_KI270752v1 chrX</code></pre>
</div>
</div>
</section>
<section id="find-overlaps-with-tss" class="level3">
<h3 class="anchored" data-anchor-id="find-overlaps-with-tss">4.2 Find overlaps with TSS</h3>
<p>Here, we’re identifying ChIP-seq peaks that overlap with TSS. This analysis can help us understand if the protein of interest tends to bind near the start of genes, which could suggest a role in transcription initiation.</p>
<div id="cell-23" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>overlaps <span class="op">=</span> peaks_chr22.find_overlaps(tss)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Peak indices that overlap with TSS between 30-40:"</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(overlaps[<span class="dv">30</span>:<span class="dv">40</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Peak indices that overlap with TSS between 30-40:
[[], [], [], [], [], [], [], [], [1157], []]</code></pre>
</div>
</div>
<pre class="{note}"><code>`find_overlaps` returns a `list` with the same length as TSS, indicating which indices from peaks overlap with each of the TSS. Ideally, we would want to return a `Hits` object similar to the Bioconductor implementation.

**TODO: Future plans to convert this into a `Hits` object.**</code></pre>
<p>Let’s identify the peaks that overlap with any TSS.</p>
<div id="cell-25" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> itertools</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>all_indices <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(itertools.chain.from_iterable(overlaps)))</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>peaks_by_tss <span class="op">=</span> peaks_chr22[all_indices]</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(peaks_by_tss)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>GenomicRanges with 75 ranges and 0 metadata columns
     seqnames              ranges          strand
        &lt;str&gt;           &lt;IRanges&gt; &lt;ndarray[int8]&gt;
 [0]    chr22 19756445 - 19756735               *
 [1]    chr22 36816145 - 36816435               *
 [2]    chr22 38467935 - 38468225               *
          ...                 ...             ...
[72]    chr22 50270553 - 50270843               *
[73]    chr22 19131257 - 19131547               *
[74]    chr22 19014170 - 19014460               *
------
seqinfo(46 sequences): chr1 chr10 chr11 ... chrUn_KI270750v1 chrUn_KI270752v1 chrX</code></pre>
</div>
</div>
<p>Alternatively, we can use <code>subset_by_overlaps</code> method to more conveniently subset the peaks that overlap with any TSS:</p>
<div id="cell-27" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>peaks_by_tss2 <span class="op">=</span> peaks_chr22.subset_by_overlaps(tss)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(peaks_by_tss2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>GenomicRanges with 75 ranges and 0 metadata columns
     seqnames              ranges          strand
        &lt;str&gt;           &lt;IRanges&gt; &lt;ndarray[int8]&gt;
 [0]    chr22 19756445 - 19756735               *
 [1]    chr22 36816145 - 36816435               *
 [2]    chr22 38467935 - 38468225               *
          ...                 ...             ...
[72]    chr22 50270553 - 50270843               *
[73]    chr22 19131257 - 19131547               *
[74]    chr22 19014170 - 19014460               *
------
seqinfo(46 sequences): chr1 chr10 chr11 ... chrUn_KI270750v1 chrUn_KI270752v1 chrX</code></pre>
</div>
</div>
</section>
<section id="find-overlaps-with-promoters" class="level3">
<h3 class="anchored" data-anchor-id="find-overlaps-with-promoters">4.3 Find overlaps with promoters</h3>
<p>This operation finds ChIP-seq peaks that overlap with our defined promoter regions. If a significant number of peaks fall within promoters, it might suggest that the protein plays a role in gene regulation.</p>
<div id="cell-29" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>peaks_by_promoters <span class="op">=</span> peaks_chr22.subset_by_overlaps(promoters)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Peaks Overlapping with Promoters:"</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(peaks_by_promoters)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Peaks Overlapping with Promoters:
GenomicRanges with 344 ranges and 0 metadata columns
      seqnames              ranges          strand
         &lt;str&gt;           &lt;IRanges&gt; &lt;ndarray[int8]&gt;
  [0]    chr22 19756445 - 19756735               *
  [1]    chr22 37427967 - 37428257               *
  [2]    chr22 19169462 - 19169752               *
           ...                 ...             ...
[341]    chr22 42368884 - 42369174               *
[342]    chr22 21630789 - 21631079               *
[343]    chr22 17368148 - 17368438               *
------
seqinfo(46 sequences): chr1 chr10 chr11 ... chrUn_KI270750v1 chrUn_KI270752v1 chrX</code></pre>
</div>
</div>
</section>
<section id="find-overlaps-with-exons" class="level3">
<h3 class="anchored" data-anchor-id="find-overlaps-with-exons">4.4 Find overlaps with exons</h3>
<p>Let’s find overlaps with any exon. We <code>unlist</code> our <code>GenomicRangesList</code> object to get all exon positions.</p>
<div id="cell-31" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all exons into a single GenomicRanges object</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>all_exons <span class="op">=</span> by_tx.as_granges()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"All exons:"</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(all_exons)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>All exons:
GenomicRanges with 34967 ranges and 6 metadata columns
                seqnames              ranges          strand           exon_id         tx_name           tx_id gene_name         gene_id exon_rank
                   &lt;str&gt;           &lt;IRanges&gt; &lt;ndarray[int8]&gt;            &lt;list&gt;          &lt;list&gt;          &lt;list&gt;    &lt;list&gt;          &lt;list&gt;    &lt;list&gt;
ENST00000006251    chr22 44677057 - 44677241               + | ENSE00001838743 ENST00000006251 ENST00000006251      PRR5 ENSG00000186654         1
ENST00000006251    chr22 44702492 - 44702609               + | ENSE00003647870 ENST00000006251 ENST00000006251      PRR5 ENSG00000186654         2
ENST00000006251    chr22 44714591 - 44714672               + | ENSE00003614159 ENST00000006251 ENST00000006251      PRR5 ENSG00000186654         3
                     ...                 ...             ... |             ...             ...             ...       ...             ...       ...
      LRG_989t1    chr22 20996696 - 20996802               + |    LRG_989t1e19       LRG_989t1       LRG_989t1     LZTR1         LRG_989        19
      LRG_989t1    chr22 20996886 - 20996967               + |    LRG_989t1e20       LRG_989t1       LRG_989t1     LZTR1         LRG_989        20
      LRG_989t1    chr22 20997232 - 20999033               + |    LRG_989t1e21       LRG_989t1       LRG_989t1     LZTR1         LRG_989        21
------
seqinfo(1 sequences): chr22</code></pre>
</div>
</div>
<p>We can then find peaks that overlap with any of these regions:</p>
<div id="cell-33" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find peaks overlapping with any exon</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>peaks_by_exons <span class="op">=</span> peaks_chr22.subset_by_overlaps(all_exons)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Peaks overlapping with exons:"</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(peaks_by_exons)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the percentage of peaks that overlap with exons</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>percent_overlapping <span class="op">=</span> (<span class="bu">len</span>(peaks_by_exons) <span class="op">/</span> <span class="bu">len</span>(peaks_chr22)) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Percentage of peaks overlapping with exons: </span><span class="sc">{</span>percent_overlapping<span class="sc">:.2f}</span><span class="ss">%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Peaks overlapping with exons:
GenomicRanges with 279 ranges and 0 metadata columns
      seqnames              ranges          strand
         &lt;str&gt;           &lt;IRanges&gt; &lt;ndarray[int8]&gt;
  [0]    chr22 19766788 - 19767078               *
  [1]    chr22 17369888 - 17370178               *
  [2]    chr22 19756445 - 19756735               *
           ...                 ...             ...
[276]    chr22 29307104 - 29307394               *
[277]    chr22 35552420 - 35552710               *
[278]    chr22 37931897 - 37932187               *
------
seqinfo(46 sequences): chr1 chr10 chr11 ... chrUn_KI270750v1 chrUn_KI270752v1 chrX
Percentage of peaks overlapping with exons: 19.36%</code></pre>
</div>
</div>
</section>
</section>
<section id="advanced-operations" class="level2">
<h2 class="anchored" data-anchor-id="advanced-operations">5. Advanced Operations</h2>
<p>Let’s explore some more complex operations that are often used in genomic analyses.</p>
<section id="compare-exonic-vs.-intronic-binding" class="level3">
<h3 class="anchored" data-anchor-id="compare-exonic-vs.-intronic-binding">5.1 Compare exonic vs.&nbsp;intronic binding</h3>
<p>Let’s first identify intronic regions. There are two ways to find introns:</p>
<ol type="1">
<li><strong>Find introns for each gene</strong>, i.e.&nbsp;regions within each gene’s transcript body that do not overlap any of that gene’s exons (using <code>psetdiff</code> in R/Bioconductor).</li>
<li><strong>Find intronic regions globally</strong>, i.e.&nbsp;regions that do not overlap with any exon (using <code>subtract</code>) for any gene. To find these positions, we ignore strand information, because there could be genes that overlap on different strands.</li>
</ol>
<p>We will find intronic regions globally (2) for our tutorial today.</p>
<p>Let’s first get all transcript ranges, following the steps in <a href="#find-transcription-start-sites-tss">Section 3.1</a>:</p>
<div id="cell-35" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the full extent of each transcript</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>tx_ranges <span class="op">=</span> by_tx.<span class="bu">range</span>().as_genomic_ranges()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now subtract any exons that overlaps within each transcript by ignoring the strand. The result is a <code>GenomicRangesList</code> containing intronic regions for each transcript. We simplify this by coercing this into a <code>GenomicRanges</code> object.</p>
<div id="cell-37" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>introns <span class="op">=</span> tx_ranges.subtract(all_exons, ignore_strand<span class="op">=</span><span class="va">True</span>).as_granges()</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Intron regions:"</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(introns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Intron regions:
GenomicRanges with 5403 ranges and 0 metadata columns
                seqnames              ranges          strand
                   &lt;str&gt;           &lt;IRanges&gt; &lt;ndarray[int8]&gt;
ENST00000006251    chr22 44677057 - 44737681               +
ENST00000008876    chr22 50603133 - 50613982               +
ENST00000043402    chr22 20241415 - 20268319               -
                     ...                 ...             ...
      LRG_856t2    chr22 33272509 - 33920477               -
       LRG_97t1    chr22 37225270 - 37244266               -
      LRG_989t1    chr22 20982297 - 20999033               +
------
seqinfo(1 sequences): chr22</code></pre>
</div>
</div>
<p>We can compare the proportion of peaks overlapping with exons to those overlapping with introns:</p>
<div id="cell-39" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find peaks overlapping with introns</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>peaks_by_introns <span class="op">=</span> peaks_chr22.subset_by_overlaps(introns)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Peaks overlapping with introns:"</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(peaks_by_introns)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate percentages</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>percent_exonic <span class="op">=</span> (<span class="bu">len</span>(peaks_by_exons) <span class="op">/</span> <span class="bu">len</span>(peaks_chr22)) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>percent_intronic <span class="op">=</span> (<span class="bu">len</span>(peaks_by_introns) <span class="op">/</span> <span class="bu">len</span>(peaks_chr22)) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Percentage of peaks overlapping with exons: </span><span class="sc">{</span>percent_exonic<span class="sc">:.2f}</span><span class="ss">%"</span>)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Percentage of peaks overlapping with introns: </span><span class="sc">{</span>percent_intronic<span class="sc">:.2f}</span><span class="ss">%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Peaks overlapping with introns:
GenomicRanges with 1000 ranges and 0 metadata columns
      seqnames              ranges          strand
         &lt;str&gt;           &lt;IRanges&gt; &lt;ndarray[int8]&gt;
  [0]    chr22 19766788 - 19767078               *
  [1]    chr22 17369888 - 17370178               *
  [2]    chr22 19756445 - 19756735               *
           ...                 ...             ...
[997]    chr22 36626768 - 36627058               *
[998]    chr22 48833277 - 48833567               *
[999]    chr22 49663362 - 49663652               *
------
seqinfo(46 sequences): chr1 chr10 chr11 ... chrUn_KI270750v1 chrUn_KI270752v1 chrX
Percentage of peaks overlapping with exons: 19.36%
Percentage of peaks overlapping with introns: 69.40%</code></pre>
</div>
</div>
<pre class="{note}"><code>These percentages may or may not add up to 100%. Some peaks may overlap both introns and exons depending on how wide they are. In our case its because of ignoring strands and finding global intronic regions. Ideally, you may want to filter the peaks based on preference as you annotate them with TSS, promoters, etc.</code></pre>
<p>This comparison can help determine if the protein of interest shows a preference for binding in exonic or intronic regions, which could suggest different functional roles (e.g., splicing regulation for exonic binding vs.&nbsp;potential enhancer activity for intronic binding).</p>
</section>
<section id="find-overlaps-with-the-first-exon" class="level3">
<h3 class="anchored" data-anchor-id="find-overlaps-with-the-first-exon">5.2 Find overlaps with the first exon</h3>
<pre class="{note}"><code>The rationale for this analysis may vary, but we are mostly showcasing complex genomic operations that can be performed.</code></pre>
<p>Let’s first put together a <code>GenomicRanges</code> object containing the first exon for each transcript.</p>
<div id="cell-41" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>all_first <span class="op">=</span> []</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> txid, grl <span class="kw">in</span> by_tx:</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    strand <span class="op">=</span> grl.get_strand(as_type <span class="op">=</span> <span class="st">"list"</span>)[<span class="dv">0</span>]</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> strand <span class="op">==</span> <span class="st">"-"</span>:</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>        all_first.append(grl.sort()[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>        all_first.append(grl.sort()[<span class="dv">0</span>])</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(all_first[:<span class="dv">3</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[GenomicRanges(number_of_ranges=1, seqnames=[0], ranges=IRanges(start=array([44677057], dtype=int32), width=array([184], dtype=int32)), strand=[1], mcols=BiocFrame(data={'exon_id': ['ENSE00001838743'], 'tx_name': ['ENST00000006251'], 'tx_id': ['ENST00000006251'], 'gene_name': ['PRR5'], 'gene_id': ['ENSG00000186654'], 'exon_rank': [1]}, number_of_rows=1, row_names=['0'], column_names=['exon_id', 'tx_name', 'tx_id', 'gene_name', 'gene_id', 'exon_rank']), seqinfoSeqInfo(number_of_seqnames=1, seqnames=['chr22'], seqlengths=[50818468], is_circular=[False], genome=['GRCh38'])), GenomicRanges(number_of_ranges=1, seqnames=[0], ranges=IRanges(start=array([50603133], dtype=int32), width=array([366], dtype=int32)), strand=[1], mcols=BiocFrame(data={'exon_id': ['ENSE00003608148'], 'tx_name': ['ENST00000008876'], 'tx_id': ['ENST00000008876'], 'gene_name': ['MAPK8IP2'], 'gene_id': ['ENSG00000008735'], 'exon_rank': [1]}, number_of_rows=1, row_names=['9'], column_names=['exon_id', 'tx_name', 'tx_id', 'gene_name', 'gene_id', 'exon_rank']), seqinfoSeqInfo(number_of_seqnames=1, seqnames=['chr22'], seqlengths=[50818468], is_circular=[False], genome=['GRCh38'])), GenomicRanges(number_of_ranges=1, seqnames=[0], ranges=IRanges(start=array([20268071], dtype=int32), width=array([248], dtype=int32)), strand=[-1], mcols=BiocFrame(data={'exon_id': ['ENSE00001358408'], 'tx_name': ['ENST00000043402'], 'tx_id': ['ENST00000043402'], 'gene_name': ['RTN4R'], 'gene_id': ['ENSG00000040608'], 'exon_rank': [1]}, number_of_rows=1, row_names=['19'], column_names=['exon_id', 'tx_name', 'tx_id', 'gene_name', 'gene_id', 'exon_rank']), seqinfoSeqInfo(number_of_seqnames=1, seqnames=['chr22'], seqlengths=[50818468], is_circular=[False], genome=['GRCh38']))]</code></pre>
</div>
</div>
<p>Then we combine all the individual genomic elements. The <a href="https://github.com/BiocPy/BiocUtils">biocutils</a> package provides utilities for convenient aspects of R that aren’t provided by base Python and generics. One of these generics is the <code>combine_sequences</code> operation that merges or concatenates 1-dimensional Bioconductor classes.</p>
<div id="cell-43" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> biocutils <span class="im">import</span> combine_sequences</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>first_exons <span class="op">=</span> combine_sequences(<span class="op">*</span>all_first)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(first_exons)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>GenomicRanges with 5387 ranges and 6 metadata columns
       seqnames              ranges          strand           exon_id         tx_name           tx_id gene_name         gene_id exon_rank
          &lt;str&gt;           &lt;IRanges&gt; &lt;ndarray[int8]&gt;            &lt;list&gt;          &lt;list&gt;          &lt;list&gt;    &lt;list&gt;          &lt;list&gt;    &lt;list&gt;
   [0]    chr22 44677057 - 44677241               + | ENSE00001838743 ENST00000006251 ENST00000006251      PRR5 ENSG00000186654         1
   [1]    chr22 50603133 - 50603499               + | ENSE00003608148 ENST00000008876 ENST00000008876  MAPK8IP2 ENSG00000008735         1
   [2]    chr22 20268071 - 20268319               - | ENSE00001358408 ENST00000043402 ENST00000043402     RTN4R ENSG00000040608         1
            ...                 ...             ... |             ...             ...             ...       ...             ...       ...
[5384]    chr22 33919995 - 33920477               - |     LRG_856t1e1       LRG_856t2       LRG_856t2    LARGE1         LRG_856         1
[5385]    chr22 37244114 - 37244266               - |      LRG_97t1e1        LRG_97t1        LRG_97t1      RAC2          LRG_97         1
[5386]    chr22 20982297 - 20982572               + |     LRG_989t1e1       LRG_989t1       LRG_989t1     LZTR1         LRG_989         1
------
seqinfo(1 sequences): chr22</code></pre>
</div>
</div>
<p>We can now subset peaks that overlap with the first exon:</p>
<div id="cell-45" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>peaks_with_first_exons <span class="op">=</span> peaks_chr22.subset_by_overlaps(first_exons)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(peaks_with_first_exons)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>GenomicRanges with 153 ranges and 0 metadata columns
      seqnames              ranges          strand
         &lt;str&gt;           &lt;IRanges&gt; &lt;ndarray[int8]&gt;
  [0]    chr22 17369888 - 17370178               *
  [1]    chr22 19756445 - 19756735               *
  [2]    chr22 45975507 - 45975797               *
           ...                 ...             ...
[150]    chr22 49500975 - 49501265               *
[151]    chr22 19131257 - 19131547               *
[152]    chr22 29307104 - 29307394               *
------
seqinfo(46 sequences): chr1 chr10 chr11 ... chrUn_KI270750v1 chrUn_KI270752v1 chrX</code></pre>
</div>
</div>
</section>
<section id="resize-and-shift-peaks" class="level3">
<h3 class="anchored" data-anchor-id="resize-and-shift-peaks">5.3 Resize and Shift Peaks</h3>
<p>Resizing and shifting genomic ranges can be useful in various contexts. For example:</p>
<ul>
<li>Narrowing peaks might help focus on the center of ChIP-seq binding sites.</li>
<li>Shifting ranges can be used to look at regions adjacent to your features of interest. e.g., defining the predicted CRISPR cleavage site based on the position of the CRISPR gRNA sequence.</li>
</ul>
<div id="cell-47" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>narrow_peaks <span class="op">=</span> peaks_chr22.narrow(start<span class="op">=</span><span class="dv">10</span>, width<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>shifted_peaks <span class="op">=</span> narrow_peaks.shift(<span class="dv">10</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Narrowed and Shifted Peaks:"</span>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(shifted_peaks)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Narrowed and Shifted Peaks:
GenomicRanges with 1441 ranges and 0 metadata columns
       seqnames              ranges          strand
          &lt;str&gt;           &lt;IRanges&gt; &lt;ndarray[int8]&gt;
   [0]    chr22 19766807 - 19766907               *
   [1]    chr22 17369907 - 17370007               *
   [2]    chr22 19756464 - 19756564               *
            ...                 ...             ...
[1438]    chr22 27212077 - 27212177               *
[1439]    chr22 49201378 - 49201478               *
[1440]    chr22 49663381 - 49663481               *
------
seqinfo(46 sequences): chr1 chr10 chr11 ... chrUn_KI270750v1 chrUn_KI270752v1 chrX</code></pre>
</div>
</div>
<p>These operations demonstrate the flexibility of genomic range manipulations, which can be useful for fine-tuning analyses or testing hypotheses about the spatial relationships between genomic features.</p>
</section>
</section>
<section id="exercises" class="level2">
<h2 class="anchored" data-anchor-id="exercises">6. Exercises</h2>
<ol type="1">
<li>Split the input genome reference by <code>gene_name</code>, e.g.&nbsp;a field that contains gene symbols.</li>
<li>Calculate the average width of the ChIP-seq peaks on chromosome 22.</li>
<li>Compute the percentage of promoter regions that have at least one overlapping ChIP-seq peak.</li>
</ol>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>In this tutorial, we’ve explored how to use BiocPy’s genomic ranges functionality to perform various genomic analyses. These tools and techniques provide a powerful way to work with genomic interval data in Python, mirroring the capabilities from Bioconductor. They form the foundation for many more complex genomic analyses and can be applied to a wide range of biological questions.</p>
<p>Refer to the <a href="https://biocpy.github.io/">BiocPy documentation</a> for more detailed information on these packages and their functionalities.</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 (c) Jayaram Kancherla &amp; Aaron Lun.
  </li>  
</ul>
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/BiocPy/BiocWorkshop2024/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>